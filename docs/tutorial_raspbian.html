---

title: Installing on Raspbian 64 bit


keywords: fastai
sidebar: home_sidebar

summary: "A tutorial on installing the `openhsi` library and camera SDKs on a Raspberry Pi 4 with 8 GB RAM."
description: "A tutorial on installing the `openhsi` library and camera SDKs on a Raspberry Pi 4 with 8 GB RAM."
nb_path: "nbs/12_tutorial_raspbian.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/12_tutorial_raspbian.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include warning.html content='This tutorial is a work in progress. ' %}{% include warning.html content='Using <code>openhsi</code> requires generating large datacubes which take up lots of RAM. It is recommended to get a Raspberry Pi 4 with as much RAM as possible, especially if you want to capture raw data. Otherwise, you will need to a <code>processing_lvl</code> that includes binning to reduce the datacube size. ' %}
A Raspberry Pi does not have the same processing power as a typical laptop/computer and so expect the framerate to drop slightly. You want a lightweight operating system so the camera can run as fast as possible - this rules out the Ubuntu 64 bit OS. If you have 8 GB of RAM, definitely get the Raspbian 64 bit OS so you can use &gt; 3 GB per process. Another benefit of running on ARM64 bit is that there are prebuilt OpenCV Python wheels - if your project requires <code>opencv-python</code>, then 64 bit is needed.
{% include note.html content='The latest 64 bit Raspbian is based on Debian 11 Bullseye (equivalent to Ubuntu 21+) and so some packages may not be updated to this platform yet. Also <code>systemd</code> is used to run scripts on startup. ' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 1</strong>: Download Raspbian 64 bit OS
<strong>Step 2</strong>: Flash a high speed micro SD card. The full install will be about 8 GB so use a larger capacity card if you can. 
{% include tip.html content='Hyperspectral datacubes are really large so best to save them to an external SSD.' %}
<strong>Step 3</strong>: Install <code>vim</code> or your favourite command line editor
<code>sudo apt-get install vim</code></p>
<p><strong>Step 4</strong>: Install your Python version of choice.
The default system Python should be 3.9.3. However, if you want to use <a href="/openhsi/cameras.html#FlirCamera"><code>FlirCamera</code></a>, the manufacturer SDK and Python library requires Python &lt;= 3.8.</p>
<p>To install any version of Python, you can use <code>pyenv</code></p>
<div class="highlight"><pre><span></span>sudo apt-get install openssl
sudo apt-get install --no-install-recommends make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
sudo apt-get install -y gcc make zlib1g-dev libreadline-dev libreadline8 sqlite3 libsqlite3-dev libbz2-dev python-tk python3-tk tk-dev
curl https://pyenv.run <span class="p">|</span> bash

<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.pyenv/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
pyenv install <span class="m">3</span>.8.12
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.pyenv/bin:</span><span class="nv">$HOME</span><span class="s2">/.pyenv/shims:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</pre></div>
<p><strong>Step 4.1</strong>: Install NodeJS
This is needed to use the Bokeh plotting library and run interactive tools in a web browser.
<code>sudo apt install nodejs</code></p>
<p><strong>Step 5</strong>: Enable I2C and UART
Open the Raspberry Pi config tool.
<code>sudo raspi-config</code>
And enable I2C and UART. For more instructions see <a href="https://askubuntu.com/questions/1273700/enable-spi-and-i2c-on-ubuntu-20-04-raspberry-pi">https://askubuntu.com/questions/1273700/enable-spi-and-i2c-on-ubuntu-20-04-raspberry-pi</a>.
After enabling them, add the user pi to the group.
<code>sudo usermod -a -G dialout pi</code>
<code>sudo usermod -a -G i2c pi</code></p>
<p>Now, to use UART at high speed, we need to change a few more settings documented here
<a href="https://www.abelectronics.co.uk/kb/article/1035/serial-port-setup-in-raspberry-pi-os">https://www.abelectronics.co.uk/kb/article/1035/serial-port-setup-in-raspberry-pi-os</a></p>
<p><strong>Step 5.1</strong>: Disable serial login shell
remove <code>console=serial0,115200</code> from /boot/cmdline.txt
then reboot.
<strong>Step 5.2</strong>: Use PI0UART instead of miniUART
Add to end of file /boot/config.txt
<code>dtoverlay=disable-bt</code>
Then in the terminal
<code>sudo systemctl disable hciuart</code>
<code>sudo reboot</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Installing-the-Battery-Hat-software">Installing the Battery Hat software<a class="anchor-link" href="#Installing-the-Battery-Hat-software"> </a></h2><p>To deploy the Raspberry Pi on a remote platform, it needs power. We use the X728 version 2.1 battery hat from Suptronics which lets us turn on and safe shutdown the Pi while indicating power left.</p>
<p>Since we are using Debian 11, we need to use systemd to enable /etc/rc-local which the battery hat scripts use. Follow the steps in 
<a href="https://www.linuxbabe.com/linux-server/how-to-enable-etcrc-local-with-systemd">https://www.linuxbabe.com/linux-server/how-to-enable-etcrc-local-with-systemd</a></p>
<p>The software for the battery hat can be found here:
<a href="https://wiki.geekworm.com/X728-Software">https://wiki.geekworm.com/X728-Software</a>
Be aware that you need to make some changes to get them to install
Change <code>python-smbus</code> to <code>python3-smbus</code>
<code>sudo apt-get install python3-smbus</code>
<code>pip install smbus</code>
<code>pip install RPi.GPIO</code>
Python 2 is deprecated so convert x728pld.py to Python 3 syntax.
Add PY_VERSION=3 on line 86 in x728-v2.0.sh (or equivalent in v2.1)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Installing-the-FLIR-SDK">Installing the FLIR SDK<a class="anchor-link" href="#Installing-the-FLIR-SDK"> </a></h2><p>You will need to install Spinnaker however you'll find that <code>spinview-qt</code> will not install because it is missing a dependency which we actually don't need (unless you want to use the GUI called SpinView).
<code>sudo apt install qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools</code>
Follow the hacks found in
<a href="https://askubuntu.com/questions/1335184/qt5-default-not-in-ubuntu-21-04">https://askubuntu.com/questions/1335184/qt5-default-not-in-ubuntu-21-04</a>
I extracted the offending package, changed a line stating the dependency, then repackaged the files.</p>
<p>More information on getting the FLIR SDK on a Raspberry Pi and Jetson is here
<a href="https://www.flir.com.au/support-center/iis/machine-vision/application-note/using-spinnaker-on-arm-and-embedded-systems/">https://www.flir.com.au/support-center/iis/machine-vision/application-note/using-spinnaker-on-arm-and-embedded-systems/</a>
{% include tip.html content='Get the aarch64 and arm64 packages (no amd)' %}
The install then becomes just
<code>sudo sh install_[according to your version].sh</code>
<code>pip install [according to your Python version].whl file</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mounting-SSD-without-sudo">Mounting SSD without sudo<a class="anchor-link" href="#Mounting-SSD-without-sudo"> </a></h2><p>The reason why we want to mount the SSD without sudo is that we can then write to it without sudo.</p>
<p>First, identify your SSD using
<code>sudo fdisk -l</code>
I followed the steps in 
<a href="https://blog.onetwentyseven001.com/mounting-without-sudo/index.html">https://blog.onetwentyseven001.com/mounting-without-sudo/index.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Congratulations, you now have a Raspbian 64 bit OS that can run the <a href="/openhsi/cameras.html#FlirCamera"><code>FlirCamera</code></a> and <code>openhsi</code>!</p>

</div>
</div>
</div>
</div>
 

